<Window
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:mCleaner"
        xmlns:ucw="clr-namespace:mCleaner.UserControls.Window"
        x:Class="mCleaner.MainWindow"
        Title="mCleaner" Height="480" Width="800" Icon="appicon.ico" WindowStartupLocation="CenterScreen"
    >

    <Window.Resources>
        <CollectionViewSource x:Key="ListViewSource" Source="{Binding DupChecker.DupplicateCollection}">
            <CollectionViewSource.GroupDescriptions>
                <PropertyGroupDescription PropertyName="Hash" />
            </CollectionViewSource.GroupDescriptions>
        </CollectionViewSource>
    </Window.Resources>

    <Window.DataContext>
        <Binding Source="{StaticResource Locator}"/>
    </Window.DataContext>

    <Grid>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto" />
                <RowDefinition Height="auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- menu bar -->
            <Menu IsMainMenu="True" Grid.Row="0" Background="{StaticResource MainWindow_Toolbar_Backgruond}" Foreground="{StaticResource MainWindow_Toolbar_Foreground}">
                <MenuItem Header="_File" Style="{DynamicResource MenuItemStyle}">
                    <MenuItem IsEnabled="True" Header="_Shred Files" Command="{Binding ShredWindow.Command_ShredFile}" />
                    <MenuItem IsEnabled="True" Header="Sh_red Folders" Command="{Binding ShredWindow.Command_ShredFolder}" />
                    <MenuItem IsEnabled="False" Header="S_hred Settings and Quit" Visibility="Collapsed" />
                    <MenuItem Header="_Quit" Command="{Binding CleanerML.Command_Quit}">
                        <MenuItem.Icon>
                            <Image Width="16" Height="16" Source="Assets/Quit.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="_Edit">
                    <MenuItem Header="Preferences" Command="{Binding Prefs.Command_Menu_Preferences}">
                        <MenuItem.Icon>
                            <Image Width="16" Height="16" Source="Assets/check_box_list.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="_Help">
                    <MenuItem IsEnabled="True" Header="Help Contents" Visibility="Collapsed">
                        <MenuItem.Icon>
                            <Image Width="16" Height="16" Source="Assets/Help.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem IsEnabled="True" Header="Release Notes" Command="{Binding ReleaseNote.Command_Menu_ReleaseNotes}">
                        <MenuItem.Icon>
                            <Image Width="16" Height="16" Source="Assets/Release Notes.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem IsEnabled="True" Header="System Information" Visibility="Collapsed" />
                    <MenuItem IsEnabled="True" Header="About" Visibility="Collapsed">
                        <MenuItem.Icon>
                            <Image Width="16" Height="16" Source="Assets/About.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
            </Menu>

            <!-- toolbar -->
            <ToolBarTray Grid.Row="1" Background="{StaticResource MainWindow_Toolbar_Backgruond}">
                <ToolBar Background="Transparent" Style="{DynamicResource ToolBarStyle}" ToolBarTray.IsLocked="True">
                    <ToolBar.Resources>
                        <Style TargetType="{x:Type Button}">
                            <Setter Property="VerticalAlignment" Value="Top" />
                        </Style>

                        <Style TargetType="{x:Type TextBlock}">
                            <Setter Property="Foreground" Value="{StaticResource MainWindow_Toolbar_Foreground}" />
                        </Style>

                    </ToolBar.Resources>
                    <Button Width="70" Command="{Binding CleanerML.Command_Preview}" ToolTip="Preview work" VerticalAlignment="Top">
                        <StackPanel>
                            <Image Width="32" Height="32" Source="Assets/Preview.png" HorizontalAlignment="Center" />
                            <TextBlock Text="Preview" HorizontalAlignment="Center" />
                            <TextBlock Text="" />
                        </StackPanel>
                    </Button>
                    <!--<Button Width="70" ToolTip="Start cleaning!" Command="{Binding CleanerML.Command_Clean}" Visibility="Collapsed">
                        <StackPanel>
                            <Image Width="32" Height="32" Source="Assets/Clean.png" HorizontalAlignment="Center" />
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Clean" HorizontalAlignment="Center" />
                                <TextBlock Text=" " />
                                <Menu Style="{DynamicResource CleanMenuStyle}">
                                    <MenuItem Style="{DynamicResource CleanMenuItemStyle}">
                                        <MenuItem.HeaderTemplate>
                                            <DataTemplate>
                                                <StackPanel>
                                                    <Image Width="16" Height="16" Source="Assets/downarrow.png" />
                                                </StackPanel>
                                            </DataTemplate>
                                        </MenuItem.HeaderTemplate>

                                        <MenuItem Header="Safe" IsChecked="{Binding CleanerML.CleanOption_Safe}" Command="{Binding CleanerML.Command_CleanOption}" CommandParameter="1"/>
                                        <MenuItem Header="Moderate" IsChecked="{Binding CleanerML.CleanOption_Moderate}" Command="{Binding CleanerML.Command_CleanOption}" CommandParameter="2"/>
                                        <MenuItem Header="Aggressive" IsChecked="{Binding CleanerML.CleanOption_Aggressive}" Command="{Binding CleanerML.Command_CleanOption}" CommandParameter="3"/>
                                    </MenuItem>
                                </Menu>
                            </StackPanel>
                        </StackPanel>
                    </Button>-->
                    <Button Width="70" ToolTip="Start cleaning!" Command="{Binding CleanerML.Command_Clean}" CommandParameter="1"  VerticalAlignment="Top">
                        <StackPanel>
                            <Image Width="32" Height="32" Source="Assets/clean_safe.png" HorizontalAlignment="Center" />
                            <TextBlock Text="Safe Cleaning" HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center" />
                        </StackPanel>
                    </Button>
                    <Button Width="70" ToolTip="Start cleaning!" Command="{Binding CleanerML.Command_Clean}" CommandParameter="2"  VerticalAlignment="Top">
                        <StackPanel>
                            <Image Width="32" Height="32" Source="Assets/clean_moderate.png" HorizontalAlignment="Center" />
                            <TextBlock Text="Moderate Cleaning" HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center" />
                        </StackPanel>
                    </Button>
                    <Button Width="70" ToolTip="Start cleaning!" Command="{Binding CleanerML.Command_Clean}" CommandParameter="3"  VerticalAlignment="Top">
                        <StackPanel>
                            <Image Width="32" Height="32" Source="Assets/clean_aggresive.png" HorizontalAlignment="Center" />
                            <TextBlock Text="Aggressive Cleaning" HorizontalAlignment="Center"  TextWrapping="Wrap" TextAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Separator />
                    <Button Width="70" Command="{Binding Clam.Command_UpdateVirusDefinition}" ToolTip="Update virus definitions"  VerticalAlignment="Top">
                        <StackPanel>
                            <Image Width="32" Height="32" Source="Assets/dl_vir_def.png" HorizontalAlignment="Center" />
                            <TextBlock Text="Update" HorizontalAlignment="Center" />
                            <TextBlock Text="" />
                        </StackPanel>
                    </Button>
                    <Button Width="70" Command="{Binding Clam.Command_ScanForVirus}" ToolTip="Scan system for virus"  VerticalAlignment="Top">
                        <StackPanel>
                            <Image Width="32" Height="32" Source="Assets/scan_for_virus.png" HorizontalAlignment="Center" />
                            <TextBlock Text="Scan" HorizontalAlignment="Center" />
                            <TextBlock Text="" />
                        </StackPanel>
                    </Button>
                    <Button Width="70" Command="{Binding Clam.Command_ScanMemory}" ToolTip="Scan system memory for virus" VerticalAlignment="Top">
                        <StackPanel>
                            <Image Width="32" Height="32" Source="Assets/scan_for_memory.png" HorizontalAlignment="Center" />
                            <TextBlock Text="Memory" HorizontalAlignment="Center" />
                            <TextBlock Text="" />
                        </StackPanel>
                    </Button>
                    <Separator />
                    <Button Width="70" Command="{Binding Clam.Command_ScanMemory}" ToolTip="Scan system memory for virus" Visibility="Collapsed">
                        <StackPanel>
                            <Image Width="32" Height="32" Source="Assets/dupcheck.png" HorizontalAlignment="Center" />
                            <TextBlock Text="Duplicate Checker" HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center" />
                        </StackPanel>
                    </Button>
                </ToolBar>
            </ToolBarTray>

            <!-- main content -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="5" />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>

                <Grid Grid.Column="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TreeView Style="{StaticResource TreeViewStyle}" 
						ItemContainerStyle="{StaticResource TreeViewItemStyleStandard}"
						ItemTemplate="{StaticResource CheckBoxItemTemplate}" 
						ItemsSource="{Binding CleanerML.CleanersCollection, Mode=OneTime}"
                        BorderThickness="0"
						x:Name="tvCleaners"
                              />
                </Grid>


                <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" />

                <Grid>
                    <Image x:Name="logo" Source="Assets/MicroHealth_Logo_800.png" Margin="50" Opacity="1" />

                    <Grid>
                        <Image Source="Assets/MicroHealth_Logo_800.png" Margin="50" Opacity="0.02" />
                        <RichTextBox x:Name="rtbCleanerDetails" BorderThickness="0" IsReadOnly="True" Background="Transparent" />
                    </Grid>

                    <Grid Visibility="{Binding CleanerML.Run, Converter={StaticResource boolTovis}}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0">
                            <Border BorderThickness="1" BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}">
                                <ProgressBar Height="25" Maximum="{Binding CleanerML.MaxProgress}" Value="{Binding CleanerML.ProgressIndex}" VerticalAlignment="Center" IsHitTestVisible="False" Margin="1" IsIndeterminate="{Binding CleanerML.ProgressIsIndeterminate}" Style="{DynamicResource ProgressBarStyle}"/>
                            </Border>
                            <TextBlock Text="{Binding CleanerML.ProgressText}" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{StaticResource MainWindow_ProgressBar_Progress_Text}" >
                                <TextBlock.Effect>
                                    <DropShadowEffect ShadowDepth="2" BlurRadius="3" Color="{DynamicResource {x:Static SystemColors.ActiveCaptionTextColorKey}}" Opacity="0.2"/>
                                </TextBlock.Effect>
                            </TextBlock>
                        </Grid>
                        <Border Grid.Row="1" Background="White">
                            <TabControl Grid.Row="1" SelectedIndex="{Binding CleanerML.SelectedTabIndex}">
                                <TabItem Header="Main">
                                    <TextBox IsReadOnly="True" BorderThickness="0" Text="{Binding CleanerML.TextLog}" AllowDrop="False" IsTabStop="False" ScrollViewer.VerticalScrollBarVisibility="Auto" />
                                </TabItem>
                                <TabItem Header="Duplicates">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <Grid Grid.Column="0" Background="{StaticResource DupChecker_Panel_FileOperation}" Visibility="{Binding DupChecker.FileOperationPanelShow, Converter={StaticResource boolTovis}}" Width="150">
                                            <StackPanel Margin="5">
                                                <StackPanel.Resources>
                                                    <Style TargetType="{x:Type TextBlock}">
                                                        <Setter Property="Foreground" Value="{StaticResource DupChecker_Panel_FileOperation_Texts}" />
                                                    </Style>
                                                    <Style TargetType="{x:Type RadioButton}">
                                                        <Setter Property="Foreground" Value="{StaticResource DupChecker_Panel_FileOperation_Texts}" />
                                                    </Style>
                                                </StackPanel.Resources>
                                                <TextBlock Text="Select what to do with duplicate files" TextWrapping="Wrap" />
                                                <TextBlock Text=" " />
                                                <RadioButton IsChecked="{Binding DupChecker.IsMove, Mode=TwoWay}" Content="Move files" Tag="Move" x:Name="rbMoveFiles" GroupName="DupCheck_FileOperation" />
                                                <RadioButton IsChecked="{Binding DupChecker.IsDelete, Mode=TwoWay}" Content="Delete files" Tag="Delete" x:Name="rbDeleteFiles" GroupName="DupCheck_FileOperation" />
                                                <TextBlock Text=" " />
                                                <Button x:Name="btnOK" Content="Start" Style="{StaticResource ButtonStyle}" Command="{Binding DupChecker.Command_Start}" />
                                            </StackPanel>
                                        </Grid>

                                        <Grid Grid.Column="1">
                                            <ListView ItemsSource="{Binding Source={StaticResource ListViewSource}}" 
                                                      ItemContainerStyle="{StaticResource ListViewItemStyle}"
                                                      x:Name="lvDuplicateFiles">
                                                <ListView.View>
                                                    <GridView>                                                        
                                                        <GridViewColumn Header="File" Width="200">
                                                            <GridViewColumn.CellTemplate>
                                                                <DataTemplate>
                                                                    <StackPanel Orientation="Horizontal">
                                                                        <CheckBox IsChecked="{Binding Selected, Mode=TwoWay}" />
                                                                        <TextBlock Text=" " />
                                                                        <TextBlock Text="{Binding FileDetails.Filename}" />
                                                                    </StackPanel>
                                                                </DataTemplate>
                                                            </GridViewColumn.CellTemplate>
                                                        </GridViewColumn>
                                                        <GridViewColumn Header="Path" Width="300" DisplayMemberBinding="{Binding FileDetails.ParentDirectory}" />
                                                    </GridView>
                                                </ListView.View>

                                                <ListView.GroupStyle>
                                                    <GroupStyle>
                                                        <GroupStyle.ContainerStyle>
                                                            <Style TargetType="{x:Type GroupItem}">
                                                                <Setter Property="Template">
                                                                    <Setter.Value>
                                                                        <ControlTemplate>
                                                                            <Expander IsExpanded="True">
                                                                                <Expander.Header>
                                                                                    <StackPanel Orientation="Horizontal">
                                                                                        <TextBlock Text="{Binding Name}" VerticalAlignment="Center" FontWeight="Bold" />
                                                                                        <TextBlock Text=" (" />
                                                                                        <TextBlock Text="{Binding ItemCount}" VerticalAlignment="Center" />
                                                                                        <TextBlock Text=") items" VerticalAlignment="Center" />
                                                                                    </StackPanel>
                                                                                </Expander.Header>
                                                                                <ItemsPresenter />
                                                                            </Expander>
                                                                        </ControlTemplate>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </GroupStyle.ContainerStyle>
                                                    </GroupStyle>
                                                </ListView.GroupStyle>

                                                <!--<ListView.ItemContainerStyle>
                                                    <Style>
                                                        <Style.Triggers>
                                                            <Trigger Property="Control.IsMouseOver" Value="True">
                                                                <Setter Property="Control.BorderThickness" Value="0" />
                                                                <Setter Property="Control.Background" Value="Transparent" />
                                                            </Trigger>
                                                            <Trigger Property="Control.IsSelected" Value="True">
                                                                <Setter Property="Control.BorderThickness" Value="0" />
                                                                <Setter Property="Control.Background" Value="Transparent" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </ListView.ItemContainerStyle>-->
                                            </ListView>
                                        </Grid>
                                    </Grid>
                                </TabItem>
                            </TabControl>
                        </Border>
                    </Grid>
                </Grid>
            </Grid>
        </Grid>

        <ucw:ClamWindow Visibility="{Binding Clam.ShowClamWinVirusUpdateWindow, Converter={StaticResource boolTovis}}"/>
        <ucw:PreferencesWindow Visibility="{Binding Prefs.ShowWindow, Converter={StaticResource boolTovis}}"/>
        <ucw:ShredWindow Visibility="{Binding ShredWindow.ShowWindow, Converter={StaticResource boolTovis}}" />
        <ucw:ReleaseNotesWindow Visibility="{Binding ReleaseNote.ShowWindow, Converter={StaticResource boolTovis}}" />
    </Grid>
</Window>